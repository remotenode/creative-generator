openapi: 3.0.3
info:
  title: Ad Generator API
  version: 1.0.0
  description: |
    AI-powered ad generator using RPC to combine persona generation, image generation, and text generation.
    
    **Features:**
    - Full persona-based targeting (20 characteristics)
    - AI-generated images via Ideogram
    - 3 text variants per ad (urgency, benefit, ease)
    - Real-time ad generation via RPC
    
    **Architecture:**
    - Persona Generator: Generates user personas with 20 characteristics
    - Image Generator: Creates AI images using Ideogram API
    - Text Generator: Produces 3 ad text variants using Cloudflare AI
    
servers:
  - url: https://ad-generator-prod.artsyom-avanesov.workers.dev
    description: Production server

paths:
  /generate-ads:
    post:
      summary: Generate personalized ads
      description: Generate complete ads with personas, AI-generated images, and 3 text variants
      operationId: generateAds
      tags:
        - Ad Generation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [prompt, country, language]
              properties:
                prompt:
                  type: string
                  description: Base prompt for ad generation
                  example: "Casino gaming app for entertainment"
                country:
                  type: string
                  description: Target country code (ISO 3166-1 alpha-2)
                  example: "US"
                language:
                  type: string
                  description: Target language code (ISO 639-1)
                  example: "en"
                count:
                  type: integer
                  minimum: 1
                  maximum: 10
                  default: 3
                  description: Number of ads to generate
      responses:
        '200':
          description: Successfully generated ads
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ads:
                        type: array
                        items:
                          $ref: '#/components/schemas/GeneratedAd'
                      totalCount:
                        type: integer
                        example: 3
                      generatedAt:
                        type: string
                        format: date-time
                      requestId:
                        type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Missing required fields"

  /health:
    get:
      summary: Health check
      description: Check the health status of all connected services
      operationId: healthCheck
      tags:
        - System
      responses:
        '200':
          description: Service health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      services:
                        type: object
                        properties:
                          personaGenerator:
                            type: boolean
                            description: Persona Generator RPC status
                          imageGenerator:
                            type: boolean
                            description: Image Generator RPC status
                          textGenerator:
                            type: boolean
                            description: Text Generator RPC status
                      timestamp:
                        type: string
                        format: date-time
                      worker:
                        type: string
                        example: "ad-generator"

  /info:
    get:
      summary: Service information
      description: Get information about the Ad Generator service
      operationId: getInfo
      tags:
        - System
      responses:
        '200':
          description: Service information
          content:
            application/json:
              schema:
                type: object
                properties:
                  service:
                    type: string
                  version:
                    type: string
                  description:
                    type: string
                  endpoints:
                    type: object

components:
  schemas:
    GeneratedAd:
      type: object
      description: A complete generated advertisement
      properties:
        id:
          type: string
          description: Unique identifier for the ad
          example: "ad-1759836288304-0cmkq09e9-1105"
        persona:
          type: object
          description: Full persona with 20 characteristics
          properties:
            persona:
              $ref: '#/components/schemas/PersonaData'
            id:
              type: integer
            createdAt:
              type: string
              format: date-time
            timestamp:
              type: string
              format: date-time
            requestId:
              type: string
            characterCount:
              type: integer
              example: 20
        image:
          type: object
          description: AI-generated image
          properties:
            url:
              type: string
              format: uri
              description: URL to the generated image
            prompt:
              type: string
              description: Enhanced prompt used for image generation
            size:
              type: string
              example: "1024x1024"
            provider:
              type: string
              example: "ideogram"
        textVariants:
          type: array
          description: All 3 text variants (urgency, benefit, ease)
          items:
            $ref: '#/components/schemas/TextVariant'
        text:
          $ref: '#/components/schemas/TextVariant'
          description: Best/recommended text variant based on quality score
        targeting:
          type: object
          properties:
            country:
              type: string
              example: "US"
            language:
              type: string
              example: "en"
            demographics:
              type: string
              description: Detailed demographic description
              example: "28-35 male Sales Representative in Urban, Middle income, Traditional lifestyle."
        qualityScore:
          type: number
          description: Overall quality score for the ad (0-10)
          example: 9
        generatedAt:
          type: string
          format: date-time

    PersonaData:
      type: object
      description: Complete persona with 20 characteristics
      properties:
        gender:
          type: string
          enum: [male, female, non-binary, prefer not to say]
        ageRange:
          type: string
          enum: [18-22, 23-27, 28-35, 36-45, 46-55, 55+]
        ethnicity:
          type: string
        location:
          type: string
          enum: [Urban, Suburban, Rural, International]
        profession:
          type: string
        education:
          type: string
        incomeLevel:
          type: string
        workStyle:
          type: string
        personality:
          type: string
        currentState:
          type: string
        communicationStyle:
          type: string
        decisionMaking:
          type: string
        primaryInterest:
          type: string
        technologyComfort:
          type: string
        lifestyle:
          type: string
        values:
          type: string
        problemSolving:
          type: string
        socialBehavior:
          type: string
        learningStyle:
          type: string
        adaptability:
          type: string

    TextVariant:
      type: object
      description: A single text ad variant
      properties:
        variant:
          type: string
          enum: [urgency, benefit, ease]
          description: Type of ad variant
        adTitle:
          type: string
          description: Ad title/headline
          maxLength: 30
        adText:
          type: string
          description: Ad body text
          maxLength: 90
        qualityScore:
          type: number
          description: Quality score (0-10)
          example: 8
        hasCallToAction:
          type: boolean
          description: Whether the ad contains a call-to-action

tags:
  - name: Ad Generation
    description: Generate personalized advertisements
  - name: System
    description: System health and information endpoints

